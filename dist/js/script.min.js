"use strict";const formWrapper=document.getElementById("form-todo-wrapper"),formTodo=document.getElementById("form-todo"),formInput=document.getElementById("form-input"),openBtn=document.getElementById("open-btn"),addBtn=document.getElementById("add"),todoList=document.getElementById("todo-list"),todo=document.getElementById("todo"),warning=document.getElementById("warning"),elemWarning=showWarning();if(openBtn.addEventListener("click",openForm),formTodo.addEventListener("submit",addTask),localStorage.getItem("todo-items")){let e=localStorage.getItem("todo-items");todoList.innerHTML=e,document.querySelectorAll(".item").forEach((e=>{let t=e.querySelector(".item-buttons__checkbox"),n=e.querySelector(".item-buttons__close");t.classList.contains("checked")?t.checked=!0:t.checked=!1,t.addEventListener("click",markTaskCompleted),n.addEventListener("click",deleteTask),e.addEventListener("pointerdown",onPointerDown)}))}function openForm(e){openBtn.classList.toggle("active"),formWrapper.classList.toggle("active"),formInput.value="",openBtn.classList.contains("active")&&setTimeout((()=>{formInput.focus()}),300)}function showWarning(){let e=!0;return function(){warning.classList.add("active"),e&&(e=!1,setTimeout((()=>{warning.classList.remove("active"),e=!0}),2500))}}function createTaskItem(e){let t=document.createElement("li");t.className="todo__item item";let n=document.createElement("div");n.className="item__body";let o=document.createElement("div");o.className="item__column item__column_1";let l=document.createElement("div");l.className="item__column item__column_2";let c=document.createElement("h2");c.className="item__title",c.innerHTML=e;let s=document.createElement("div");s.className="item-buttons";let i=document.createElement("div");i.className="item-buttons__checked-btns";let a=document.createElement("input");a.className="item-buttons__checkbox",a.type="checkbox";let m=document.createElement("div");m.className="item-buttons__customcheckbox";let d=document.createElement("button");d.className="item-buttons__close";let r=document.createElement("i");return r.className="fas fa-check",m.append(r),i.append(a,m),s.append(i,d),l.append(s),o.append(c),n.append(o,l),t.append(n),a.addEventListener("click",markTaskCompleted),d.addEventListener("click",deleteTask),t.addEventListener("pointerdown",onPointerDown),toLocal(),t}function addTask(e){if(e.preventDefault(),formInput.focus(),formInput.value.trim()){let e=createTaskItem(formInput.value);todoList.append(e),formInput.value="",toLocal()}else elemWarning()}function markTaskCompleted(e){let t=this,n=t.closest(".item");t.checked?(t.classList.add("checked"),n.classList.add("completed"),toLocal()):(t.classList.remove("checked"),n.classList.remove("completed"),toLocal())}function deleteTask(){this.closest(".item").remove(),toLocal()}function onPointerDown(e){if(e.target.closest(".item-buttons__checkbox")||e.target.closest(".item-buttons__close"))return;let t=e.target.closest(".item"),n=t.parentNode,o=document.querySelectorAll(".item"),l=t.cloneNode(!0);l.setAttribute("data-clone",!0),l.style.opacity=.4,l.style.zIndex=50;let c=t.getBoundingClientRect(),s=t.offsetWidth,i=t.offsetHeight,a=e.clientX-c.x,m=e.clientY-c.y;function d(e){e.preventDefault();let c=e.clientX-a,s=e.pageY-m;t.style.left=`${c}px`,t.style.top=`${s}px`;let i=t.getBoundingClientRect().top,d=i+t.offsetHeight;if(i<=0&&window.scrollBy(0,i),d>=document.documentElement.offsetHeight){let e=Math.abs(document.documentElement.offsetHeight-d);window.scrollBy(0,e)}t.hidden=!0;let r=document.elementFromPoint(e.clientX,e.clientY);t.hidden=!1,r&&(r=r.closest(".item"),r&&!r.closest('[data-clone="true"]')?r.classList.add("below"):removeClassBelow(o),r&&!r.closest('[data-clone="true"]')&&(r.nextElementSibling===t?getNextElement(e.clientY,r)||(n.insertBefore(l,r),n.insertBefore(t,r)):getNextElement(e.clientY,r)&&(n.insertBefore(l,r.nextElementSibling),n.insertBefore(t,r.nextElementSibling))))}t.style.position="absolute",t.style.left=e.clientX-a+"px",t.style.top=e.pageY-m+"px",t.style.width="100%",t.style.maxWidth=`${s}px`,t.style.height=`${i}px`,t.style.zIndex=100,t.style.cursor="grabbing",n.insertBefore(l,t),document.addEventListener("pointermove",d),document.addEventListener("pointerup",(function e(n){t.style.cursor="grab",t.style.position="static",l.remove(),removeClassBelow(o),document.removeEventListener("pointermove",d),document.removeEventListener("pointerup",e),toLocal()})),t.ondragstart=function(){return!1}}function removeClassBelow(e){for(let t=0;t<e.length;t++)e[t].classList.remove("below")}function getNextElement(e,t){return e>t.getBoundingClientRect().top+t.offsetHeight/2}function toLocal(){let e=todoList.innerHTML;localStorage.setItem("todo-items",e)}window.addEventListener("resize",(()=>{let e=document.querySelectorAll(".item");for(let t=0;t<e.length;t++)e[t].style.maxWidth=`${todoList.offsetWidth}px`})),document.addEventListener("keyup",(e=>{"Escape"===e.code&&(openBtn.classList.remove("active"),formWrapper.classList.remove("active"))}));